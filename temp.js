/* const data = [
  {
    "dept": {
      "id": "1693563109719426666",
      "createUser": null,
      "createTime": null,
      "updateUser": null,
      "updateTime": null,
      "version": 0,
      "disable": 0,
      "qywxDeptId": "1",
      "name": "测试内部接口",
      "nameEn": null,
      "departmentLeader": null,
      "qywxParentId": "0",
      "order": 0,
      "lastSynchTime": null,
      "path": "1693563109719426666",
      "depth": 0,
      "parentId": "0"
    },
    "subList": [
      {
        "dept": {
          "id": "1693563109719425041",
          "createUser": null,
          "createTime": null,
          "updateUser": null,
          "updateTime": null,
          "version": 0,
          "disable": 0,
          "qywxDeptId": "2",
          "name": "里",
          "nameEn": null,
          "departmentLeader": null,
          "qywxParentId": "1",
          "order": 0,
          "lastSynchTime": null,
          "path": "1693563109719426666.1693563109719425041",
          "depth": 1,
          "parentId": "1693563109719426666"
        },
        "subList": [
          {
            "dept": {
              "id": "1693563109719422344",
              "createUser": null,
              "createTime": null,
              "updateUser": null,
              "updateTime": null,
              "version": 0,
              "disable": 0,
              "qywxDeptId": "3",
              "name": "第三层",
              "nameEn": null,
              "departmentLeader": null,
              "qywxParentId": "2",
              "order": 0,
              "lastSynchTime": null,
              "path": "1693563109719426666.1693563109719425041.1693563109719422344",
              "depth": 2,
              "parentId": "1693563109719425041"
            },
            "subList": []
          }
        ]
      }
    ]
  }
] */

const data = [
  {
    "dept": {
      "id": "1693563109719426666",
      "createUser": null,
      "createTime": null,
      "updateUser": null,
      "updateTime": null,
      "version": 0,
      "disable": 0,
      "qywxDeptId": "1",
      "name": "测试内部接口",
      "nameEn": null,
      "departmentLeader": null,
      "qywxParentId": "0",
      "order": 0,
      "lastSynchTime": null,
      "path": "1693563109719426666",
      "depth": 0,
      "parentId": "0",
      "userList": [
        {
          "id": "1693563109719425262",
          "createUser": null,
          "createTime": null,
          "updateUser": null,
          "updateTime": null,
          "version": null,
          "disable": null,
          "name": "苏文辉",
          "account": null,
          "password": null,
          "superManager": null,
          "qywxUserId": null,
          "source": null,
          "directLeader": null,
          "position": null,
          "mobile": null,
          "gender": null,
          "email": null,
          "bizMail": null,
          "avatar": null,
          "thumbAvatar": null,
          "telephone": null,
          "alias": null,
          "status": null,
          "address": null,
          "englishName": null,
          "openUserid": null,
          "qrCode": null,
          "externalPosition": null,
          "extattr": null,
          "externalProfile": null,
          "lastSynchTime": null
        },
        {
          "id": "1693563109719425042",
          "createUser": null,
          "createTime": null,
          "updateUser": null,
          "updateTime": null,
          "version": null,
          "disable": null,
          "name": "侯铿圣",
          "account": null,
          "password": null,
          "superManager": null,
          "qywxUserId": null,
          "source": null,
          "directLeader": null,
          "position": null,
          "mobile": null,
          "gender": null,
          "email": null,
          "bizMail": null,
          "avatar": null,
          "thumbAvatar": null,
          "telephone": null,
          "alias": null,
          "status": null,
          "address": null,
          "englishName": null,
          "openUserid": null,
          "qrCode": null,
          "externalPosition": null,
          "extattr": null,
          "externalProfile": null,
          "lastSynchTime": null
        }
      ]
    },
    "subList": [
      {
        "dept": {
          "id": "1693563109719425041",
          "createUser": null,
          "createTime": null,
          "updateUser": null,
          "updateTime": null,
          "version": 0,
          "disable": 0,
          "qywxDeptId": "2",
          "name": "里",
          "nameEn": null,
          "departmentLeader": null,
          "qywxParentId": "1",
          "order": 0,
          "lastSynchTime": null,
          "path": "1693563109719426666.1693563109719425041",
          "depth": 1,
          "parentId": "1693563109719426666",
          "userList": [
            {
              "id": "1693563109719425042",
              "createUser": null,
              "createTime": null,
              "updateUser": null,
              "updateTime": null,
              "version": null,
              "disable": null,
              "name": "侯铿圣",
              "account": null,
              "password": null,
              "superManager": null,
              "qywxUserId": null,
              "source": null,
              "directLeader": null,
              "position": null,
              "mobile": null,
              "gender": null,
              "email": null,
              "bizMail": null,
              "avatar": null,
              "thumbAvatar": null,
              "telephone": null,
              "alias": null,
              "status": null,
              "address": null,
              "englishName": null,
              "openUserid": null,
              "qrCode": null,
              "externalPosition": null,
              "extattr": null,
              "externalProfile": null,
              "lastSynchTime": null
            }
          ]
        },
        "subList": [
          {
            "dept": {
              "id": "1693563109719422344",
              "createUser": null,
              "createTime": null,
              "updateUser": null,
              "updateTime": null,
              "version": 0,
              "disable": 0,
              "qywxDeptId": "3",
              "name": "第三层",
              "nameEn": null,
              "departmentLeader": null,
              "qywxParentId": "2",
              "order": 0,
              "lastSynchTime": null,
              "path": "1693563109719426666.1693563109719425041.1693563109719422344",
              "depth": 2,
              "parentId": "1693563109719425041",
              "userList": [
                {
                  "id": "1693563109719420909",
                  "createUser": null,
                  "createTime": null,
                  "updateUser": null,
                  "updateTime": null,
                  "version": null,
                  "disable": null,
                  "name": "柳永杰",
                  "account": null,
                  "password": null,
                  "superManager": null,
                  "qywxUserId": null,
                  "source": null,
                  "directLeader": null,
                  "position": null,
                  "mobile": null,
                  "gender": null,
                  "email": null,
                  "bizMail": null,
                  "avatar": null,
                  "thumbAvatar": null,
                  "telephone": null,
                  "alias": null,
                  "status": null,
                  "address": null,
                  "englishName": null,
                  "openUserid": null,
                  "qrCode": null,
                  "externalPosition": null,
                  "extattr": null,
                  "externalProfile": null,
                  "lastSynchTime": null
                }
              ]
            },
            "subList": []
          }
        ]
      }
    ]
  }
]
/**
* 构造树型结构数据
* @param {*} data 数据源
* @param {*} id id字段 默认 'id'
* @param {*} parentId 父节点字段 默认 'parentId'
* @param {*} children 孩子节点字段 默认 'children'
*/
function convertToTreeData(data, pid) {
  return data.map(item => {
    if (item.dept) {
      if (item.dept.userList) {
        return {
          id: item.dept.id,
          label: item.dept.name,
          children: item.dept.userList.map(item => ({
            id: item.id,
            label: item.name
          })).concat(convertToTreeData(item.subList))  //这里无法直接访问convertToTreeData函数
        }
      } else {
        return {
          id: item.dept.id,
          label: item.dept.name,
          children: convertToTreeData(item.subList)
        }
      }
    } else if (item.label) {
      if (!item.subList.length) {
        return {
          id: item.label.id,
          pid,
          label: item.label.name,
        }
      } else {
        return {
          id: item.label.id,
          pid,
          label: item.label.name,
          children: convertToTreeData(item.subList, item.label.id)
        }
      }
    }
  })
}


/**
 * 构造树型结构数据
 * @param {*} data 数据源
 * @param {*} id id字段 默认 'id'
 * @param {*} parentId 父节点字段 默认 'parentId'
 * @param {*} children 孩子节点字段 默认 'children'
 */
function handleTree(data, id, parentId, children) {
  let config = {
    id: id || 'id',
    parentId: parentId || 'parentId',
    childrenList: children || 'children'
  };

  var childrenListMap = {};
  var nodeIds = {};
  var tree = [];

  for (let d of data) {
    let parentId = d[config.parentId];
    if (childrenListMap[parentId] == null) {
      childrenListMap[parentId] = [];
    }
    nodeIds[d[config.id]] = d;
    childrenListMap[parentId].push(d);
  }

  for (let d of data) {
    let parentId = d[config.parentId];
    if (nodeIds[parentId] == null) {
      tree.push(d);
    }
  }

  for (let t of tree) {
    adaptToChildrenList(t);
  }

  function adaptToChildrenList(o) {
    if (childrenListMap[o[config.id]] !== null) {
      o[config.childrenList] = childrenListMap[o[config.id]];
    }
    if (o[config.childrenList]) {
      for (let c of o[config.childrenList]) {
        adaptToChildrenList(c);
      }
    }
  }
  return tree;
}

// const res = convertToTreeData(data)
// console.log(JSON.stringify(res, null, 2))

const res = handleTree(data,)
